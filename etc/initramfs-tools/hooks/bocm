#!/bin/sh
#set -x
PREREQ=""
prereqs()
{
     echo "$PREREQ"
}

case $1 in
prereqs)
     prereqs
     exit 0
     ;;
esac

. /usr/share/initramfs-tools/hook-functions
# Begin real processing below this line


# from /usr/share/initramfs-tools/scripts/nfs
manual_add_modules nfs
# For DHCP
manual_add_modules af_packet
copy_exec /sbin/dhclient
copy_exec ${BOCMDIR}/dhclient-script /sbin

copy_exec /bin/ln 

copy_exec /bin/chown

copy_exec /sbin/sgdisk /sbin
copy_exec /bin/lsblk /bin

copy_exec /sbin/mkfs.xfs /sbin
copy_exec /sbin/fsck.xfs /sbin
copy_exec /sbin/xfs_repair /sbin
copy_exec /usr/sbin/xfs_db /sbin
copy_exec /sbin/mkfs.vfat /sbin
copy_exec /sbin/mkswap /sbin
copy_exec /usr/bin/rsync /bin

copy_exec /usr/bin/head	/bin
copy_exec /usr/bin/md5sum /bin

copy_exec /bin/dd /bin
copy_exec /usr/bin/find /usr/bin/find

copy_exec /sbin/vconfig

# Dodane po to by dzialal dns
for _LIBRARY in /lib/x86_64-linux-gnu/libnss_dns*
do
        if [ -e "${_LIBRARY}" ]
        then
                copy_exec ${_LIBRARY} /lib
        fi
done

copy_exec /bin/tar /bin
copy_exec /usr/bin/wget /usr/bin/wget
copy_exec /bin/bash /bin/bash
copy_exec /usr/bin/ssh /usr/bin/ssh

# Kopiowanie klucza dostepowego do boipxe
copy_file BOCM_key /etc/bocm/boipxe_rsa
copy_file BOCM_key_pub /etc/bocm/boipxe_rsa.pub

# Na potrzeby formatowania dysku
copy_file BOCM_default /etc/bocm/default
copy_file BOCM_functions /etc/bocm/functions.sh
copy_file BOCM_fstab /etc/bocm/fstab
copy_file BOCM_partitions.yml /etc/bocm/partitions.yml
copy_file BOCM_bash_yaml /etc/bocm/bash-yaml/script/yaml.sh
copy_file BOCM_rc.local /etc/bocm/rc.local

# Na potrzeby klienta ssh
copy_file SSH_PASSWD /etc/passwd /etc/passwd

exit 0
